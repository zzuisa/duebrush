# 后端项目架构说明

## 架构概览

重构后的项目采用了分层架构设计，将原来的单一文件拆分为多个功能模块，提高了代码的可维护性和可扩展性。

```
┌─────────────────────────────────────────────────────────────┐
│                        Flask 应用层                          │
├─────────────────────────────────────────────────────────────┤
│                        路由层 (Routes)                       │
│  ┌─────────┬─────────┬─────────┬─────────┬─────────┬──────┐  │
│  │  auth   │paintings│contacts │ uploads │  site   │static│  │
│  └─────────┴─────────┴─────────┴─────────┴─────────┴──────┘  │
├─────────────────────────────────────────────────────────────┤
│                        模型层 (Models)                       │
│  ┌─────────┬─────────┬─────────┐                            │
│  │painting │ contact │  site   │                            │
│  └─────────┴─────────┴─────────┘                            │
├─────────────────────────────────────────────────────────────┤
│                        工具层 (Utils)                        │
│  ┌─────────┬─────────┬─────────┐                            │
│  │  auth   │  email  │file_utils│                           │
│  └─────────┴─────────┴─────────┘                            │
├─────────────────────────────────────────────────────────────┤
│                        配置层 (Config)                       │
└─────────────────────────────────────────────────────────────┘
```

## 分层设计

### 1. 配置层 (Config)
- **职责**: 集中管理所有配置项
- **文件**: `config.py`
- **功能**:
  - 环境变量配置
  - 路径配置
  - 邮件配置
  - 认证配置
  - 目录初始化

### 2. 工具层 (Utils)
- **职责**: 提供通用工具函数
- **模块**:
  - `auth.py`: 认证相关工具
  - `email.py`: 邮件发送工具
  - `file_utils.py`: 文件处理工具

### 3. 模型层 (Models)
- **职责**: 数据访问和业务逻辑
- **模块**:
  - `painting.py`: 绘画数据模型
  - `contact.py`: 联系表单数据模型
  - `site.py`: 网站数据模型

### 4. 路由层 (Routes)
- **职责**: HTTP请求处理和响应
- **模块**:
  - `auth.py`: 认证路由
  - `paintings.py`: 绘画管理路由
  - `contacts.py`: 联系表单路由
  - `uploads.py`: 文件上传路由
  - `site.py`: 网站数据路由
  - `static.py`: 静态文件路由

## 数据流

```
客户端请求 → 路由层 → 模型层 → 工具层 → 数据存储
     ↑                                    ↓
     └────────────── 响应 ←───────────────┘
```

## 模块依赖关系

```
Routes (路由层)
  ↓
Models (模型层)
  ↓
Utils (工具层)
  ↓
Config (配置层)
```

## 设计原则

### 1. 单一职责原则
每个模块只负责一个特定的功能领域。

### 2. 依赖倒置原则
高层模块不依赖低层模块，都依赖抽象。

### 3. 开闭原则
对扩展开放，对修改关闭。

### 4. 接口隔离原则
客户端不应该依赖它不需要的接口。

## 扩展指南

### 添加新功能
1. 在 `models/` 中添加数据模型
2. 在 `routes/` 中添加路由处理
3. 在 `utils/` 中添加工具函数（如需要）
4. 在 `app/app.py` 中注册新的蓝图

### 添加新的API端点
1. 在相应的路由文件中添加新的路由函数
2. 使用适当的认证装饰器
3. 调用相应的模型方法

### 添加新的数据模型
1. 创建新的模型文件
2. 实现CRUD操作
3. 在路由中使用新模型

## 测试策略

### 单元测试
- 每个模块可以独立测试
- 使用模拟对象隔离依赖

### 集成测试
- 测试模块间的交互
- 测试完整的API流程

### 端到端测试
- 测试完整的用户场景
- 验证前后端集成

## 部署考虑

### 环境配置
- 使用环境变量管理配置
- 支持不同环境的配置

### 性能优化
- 数据库连接池
- 缓存策略
- 静态文件CDN

### 安全考虑
- 输入验证
- SQL注入防护
- XSS防护
- CSRF防护
